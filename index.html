<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GoalFlow ‚Äì Smart Goals Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Track your goals, daily progress and streaks in a clean, professional dashboard." />
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #050816;
      --bg-alt: #090f1f;
      --card: #0b1020;
      --accent: #4f46e5;
      --accent-soft: rgba(79,70,229,0.12);
      --accent-strong: rgba(79,70,229,0.3);
      --text: #f9fafb;
      --muted: #9ca3af;
      --danger: #ef4444;
      --success: #22c55e;
      --border: #1f2937;
      --radius-lg: 20px;
      --radius-full: 999px;
      --shadow-soft: 0 18px 45px rgba(0,0,0,0.50);
      --transition-fast: 0.18s ease-out;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Poppins", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: radial-gradient(circle at top left, #111827, #020617);
      color: var(--text);
      min-height: 100vh;
      padding: 16px;
      display: flex;
      justify-content: center;
    }

    .app-shell {
      width: 100%;
      max-width: 1120px;
      background: linear-gradient(135deg, rgba(15,23,42,0.95), rgba(8,14,34,0.98));
      border-radius: 28px;
      border: 1px solid rgba(148,163,184,0.2);
      box-shadow: var(--shadow-soft);
      padding: 20px 18px 22px;
      display: flex;
      flex-direction: column;
      gap: 18px;
      backdrop-filter: blur(22px);
    }

    /* HEADER */

    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding-bottom: 6px;
      border-bottom: 1px solid rgba(148,163,184,0.12);
    }

    .branding {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-circle {
      width: 40px;
      height: 40px;
      border-radius: 16px;
      background: radial-gradient(circle at 30% 0%, #818cf8, #4f46e5 40%, #0ea5e9 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 18px;
      text-shadow: 0 4px 12px rgba(0,0,0,0.5);
    }

    .brand-text-title {
      font-weight: 600;
      font-size: 1.1rem;
      letter-spacing: 0.04em;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .brand-badge {
      font-size: 0.7rem;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.45);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
    }

    .brand-subtitle {
      font-size: 0.78rem;
      color: var(--muted);
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .pill {
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 0.72rem;
      border: 1px solid rgba(148,163,184,0.4);
      color: var(--muted);
      display: flex;
      align-items: center;
      gap: 6px;
      background: rgba(15,23,42,0.8);
    }

    .primary-btn {
      border-radius: 999px;
      padding: 7px 14px;
      border: none;
      font-size: 0.8rem;
      font-weight: 500;
      background: linear-gradient(135deg, #4f46e5, #6366f1);
      color: #f9fafb;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 12px 35px rgba(79,70,229,0.45);
      transition: transform var(--transition-fast), box-shadow var(--transition-fast);
    }

    .primary-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 20px 40px rgba(79,70,229,0.55);
    }

    .primary-btn span.icon {
      font-size: 0.9rem;
    }

    /* DASHBOARD STRIP */

    .dash-strip {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
    }

    .metric-card {
      background: radial-gradient(circle at top left, rgba(55,65,81,0.6), rgba(15,23,42,0.9));
      border-radius: 18px;
      padding: 12px 14px;
      border: 1px solid rgba(148,163,184,0.3);
      position: relative;
      overflow: hidden;
    }

    .metric-label {
      font-size: 0.74rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin-bottom: 4px;
    }

    .metric-value {
      font-size: 1.35rem;
      font-weight: 600;
      display: flex;
      align-items: baseline;
      gap: 4px;
    }

    .metric-chip {
      font-size: 0.7rem;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(148,163,184,0.4);
      color: var(--muted);
    }

    .metric-footer {
      margin-top: 6px;
      font-size: 0.7rem;
      color: var(--muted);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 4px;
    }

    .trend-up {
      color: var(--success);
      font-size: 0.7rem;
    }

    /* MAIN LAYOUT */

    .main-layout {
      display: grid;
      grid-template-columns: minmax(0, 0.95fr) minmax(0, 1.4fr);
      gap: 16px;
      align-items: flex-start;
    }

    .panel {
      background: radial-gradient(circle at top left, rgba(30,64,175,0.18), rgba(15,23,42,0.95));
      border-radius: 22px;
      padding: 14px 14px 15px;
      border: 1px solid rgba(148,163,184,0.22);
      box-shadow: 0 12px 30px rgba(0,0,0,0.45);
    }

    .panel-header-line {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 12px;
    }

    .panel-title {
      font-size: 0.98rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .panel-subtitle {
      font-size: 0.74rem;
      color: var(--muted);
    }

    .tiny-pill {
      font-size: 0.68rem;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.45);
      color: var(--muted);
    }

    /* FORM */

    .form-grid {
      display: grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap: 10px;
      margin-bottom: 10px;
    }

    .field-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    label {
      font-size: 0.74rem;
      color: var(--muted);
    }

    .input, .select {
      padding: 8px 10px;
      border-radius: 12px;
      border: 1px solid rgba(148,163,184,0.45);
      background: rgba(15,23,42,0.95);
      color: var(--text);
      font-size: 0.82rem;
      outline: none;
      transition: border var(--transition-fast), box-shadow var(--transition-fast), transform var(--transition-fast);
    }

    .input:focus, .select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(79,70,229,0.5);
      transform: translateY(-0.5px);
    }

    .inline-fields {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
    }

    .helper-text {
      font-size: 0.7rem;
      color: var(--muted);
      margin-top: 4px;
    }

    .form-actions {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 10px;
      gap: 6px;
      flex-wrap: wrap;
    }

    .ghost-btn {
      border-radius: 999px;
      padding: 6px 10px;
      border: 1px solid rgba(148,163,184,0.35);
      background: transparent;
      color: var(--muted);
      font-size: 0.72rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: background var(--transition-fast), transform var(--transition-fast);
    }

    .ghost-btn:hover {
      background: rgba(15,23,42,0.9);
      transform: translateY(-0.5px);
    }

    /* GOALS LIST */

    .tools-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .search-box {
      flex: 1;
      position: relative;
    }

    .search-box .input {
      width: 100%;
      padding-left: 28px;
    }

    .search-icon {
      position: absolute;
      left: 9px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.85rem;
      color: var(--muted);
    }

    .select {
      min-width: 120px;
    }

    .goals-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-height: 360px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .goals-list::-webkit-scrollbar {
      width: 6px;
    }
    .goals-list::-webkit-scrollbar-track {
      background: transparent;
    }
    .goals-list::-webkit-scrollbar-thumb {
      background: rgba(148,163,184,0.4);
      border-radius: 999px;
    }

    .goal-item {
      background: linear-gradient(135deg, rgba(15,23,42,0.96), rgba(15,23,42,0.85));
      border-radius: 16px;
      padding: 10px 11px 9px;
      border: 1px solid rgba(148,163,184,0.35);
      display: grid;
      grid-template-columns: minmax(0, 1.65fr) minmax(0, 1.1fr);
      gap: 10px;
      align-items: center;
      transition: transform var(--transition-fast), box-shadow var(--transition-fast), border-color var(--transition-fast), background var(--transition-fast);
    }

    .goal-item:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 35px rgba(0,0,0,0.55);
      border-color: var(--accent-strong);
      background: radial-gradient(circle at top left, rgba(79,70,229,0.24), rgba(15,23,42,0.96));
    }

    .goal-main {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .goal-title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .goal-title {
      font-size: 0.88rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .goal-chip {
      font-size: 0.66rem;
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(148,163,184,0.5);
      color: var(--muted);
    }

    .goal-meta {
      font-size: 0.72rem;
      color: var(--muted);
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .meta-dot {
      width: 4px;
      height: 4px;
      border-radius: 999px;
      background: rgba(148,163,184,0.6);
      display: inline-block;
    }

    .status-pill {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(52,211,153,0.6);
      background: rgba(22,163,74,0.08);
      color: #6ee7b7;
    }

    .status-pill.completed {
      border-color: rgba(59,130,246,0.75);
      background: rgba(37,99,235,0.1);
      color: #93c5fd;
    }

    .goal-progress {
      margin-top: 6px;
    }

    .progress-bar-track {
      height: 7px;
      border-radius: 999px;
      background: rgba(31,41,55,0.85);
      overflow: hidden;
      position: relative;
    }

    .progress-bar-fill {
      height: 100%;
      border-radius: inherit;
      background: linear-gradient(90deg, #4f46e5, #22c55e);
      width: 0%;
      transition: width 0.25s ease-out;
    }

    .progress-label-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.7rem;
      color: var(--muted);
      margin-top: 3px;
    }

    .goal-actions {
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: flex-end;
      flex-wrap: wrap;
    }

    .mini-btn {
      padding: 5px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.5);
      background: rgba(15,23,42,0.9);
      font-size: 0.7rem;
      color: #e5e7eb;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: background var(--transition-fast), transform var(--transition-fast), border var(--transition-fast);
    }

    .mini-btn:hover {
      background: rgba(31,41,55,0.95);
      transform: translateY(-0.5px);
    }

    .mini-btn.accent {
      border-color: rgba(79,70,229,0.8);
    }

    .mini-btn.danger {
      border-color: rgba(248,113,113,0.85);
      color: #fecaca;
    }

    .empty-state {
      padding: 20px 10px 8px;
      font-size: 0.8rem;
      text-align: center;
      color: var(--muted);
    }

    /* FOOTER */

    .app-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 0.7rem;
      color: var(--muted);
      padding-top: 6px;
      border-top: 1px solid rgba(148,163,184,0.16);
      gap: 8px;
      flex-wrap: wrap;
    }

    .footer-tagline {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .dot-pulse {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 10px rgba(34,197,94,0.7);
    }

    /* RESPONSIVE */

    @media (max-width: 900px) {
      .app-shell {
        border-radius: 20px;
        padding: 14px 12px 16px;
      }

      .dash-strip {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }

      .main-layout {
        grid-template-columns: 1fr;
      }

      .goal-item {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 640px) {
      body {
        padding: 10px;
      }

      .dash-strip {
        grid-template-columns: 1fr;
      }

      .app-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .header-actions {
        width: 100%;
        justify-content: space-between;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <!-- HEADER -->
    <header class="app-header">
      <div class="branding">
        <div class="logo-circle">G</div>
        <div>
          <div class="brand-text-title">
            GoalFlow
            <span class="brand-badge">Daily Tracker</span>
          </div>
          <div class="brand-subtitle">
            Turn your <strong>targets</strong> into <strong>daily action</strong>.
          </div>
        </div>
      </div>

      <div class="header-actions">
        <div class="pill">
          <span id="today-label">Today</span>
        </div>
        <button class="primary-btn" id="quick-add-btn">
          <span class="icon">‚ö°</span>
          Quick add goal
        </button>
      </div>
    </header>

    <!-- DASHBOARD STRIP -->
    <section class="dash-strip">
      <article class="metric-card">
        <div class="metric-label">Active goals</div>
        <div class="metric-value">
          <span id="metric-active">0</span>
          <span class="metric-chip">Total</span>
        </div>
        <div class="metric-footer">
          <span>Keep your list tight & focused.</span>
          <span class="trend-up" id="metric-completed-today">0 done today</span>
        </div>
      </article>

      <article class="metric-card">
        <div class="metric-label">Average progress</div>
        <div class="metric-value">
          <span id="metric-progress">0%</span>
          <span class="metric-chip">All goals</span>
        </div>
        <div class="metric-footer">
          <span>Consistency beats intensity.</span>
          <span class="trend-up">Push +1% today</span>
        </div>
      </article>

      <article class="metric-card">
        <div class="metric-label">Daily streak</div>
        <div class="metric-value">
          <span id="metric-streak">0</span>
          <span class="metric-chip">days</span>
        </div>
        <div class="metric-footer">
          <span>Log at least one update.</span>
          <span class="trend-up">Don‚Äôt break the chain üîó</span>
        </div>
      </article>
    </section>

    <!-- MAIN LAYOUT -->
    <section class="main-layout">
      <!-- LEFT: CREATE GOAL -->
      <article class="panel">
        <div class="panel-header-line">
          <div>
            <div class="panel-title">
              New goal
              <span class="tiny-pill">SMART + Trackable</span>
            </div>
            <p class="panel-subtitle">Define what winning looks like and set a clear target.</p>
          </div>
        </div>

        <form id="goal-form">
          <div class="field-group">
            <label for="goal-title">Goal title</label>
            <input id="goal-title" class="input" type="text" placeholder="Example: Lose 5 kg, Learn Python, Save ‚Çπ10,000" required>
          </div>

          <div class="form-grid">
            <div class="field-group">
              <label for="goal-category">Category</label>
              <select id="goal-category" class="select">
                <option value="Fitness">Fitness</option>
                <option value="Career">Career</option>
                <option value="Money">Money</option>
                <option value="Skills">Skills</option>
                <option value="Mindset">Mindset</option>
                <option value="Other">Other</option>
              </select>
            </div>

            <div class="field-group">
              <label for="goal-target">Target units</label>
              <input id="goal-target" class="input" type="number" min="1" placeholder="e.g. 30" required>
              <div class="helper-text">Example: 30 workouts, 10 chapters, ‚Çπ20,000‚Ä¶</div>
            </div>
          </div>

          <div class="inline-fields">
            <div class="field-group">
              <label for="goal-unit-label">Unit label</label>
              <input id="goal-unit-label" class="input" type="text" placeholder="workouts / days / ‚Çπ" />
            </div>
            <div class="field-group">
              <label for="goal-due">Deadline</label>
              <input id="goal-due" class="input" type="date" />
            </div>
            <div class="field-group">
              <label for="goal-start">Start today?</label>
              <select id="goal-start" class="select">
                <option value="today" selected>Yes, from today</option>
                <option value="tomorrow">From tomorrow</option>
              </select>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="ghost-btn" id="seed-demo-btn">
              ‚öôÔ∏è Load demo goals
            </button>

            <button type="submit" class="primary-btn">
              <span class="icon">‚ûï</span>
              Add goal
            </button>
          </div>
        </form>
      </article>

      <!-- RIGHT: GOALS LIST -->
      <article class="panel">
        <div class="panel-header-line">
          <div>
            <div class="panel-title">
              Your goals board
            </div>
            <p class="panel-subtitle">Update progress in one tap. Tap ‚Äú+1‚Äù every time you move.</p>
          </div>
        </div>

        <div class="tools-row">
          <div class="search-box">
            <span class="search-icon">üîç</span>
            <input id="search-input" class="input" type="text" placeholder="Search by name or category‚Ä¶" />
          </div>
          <select id="filter-select" class="select">
            <option value="all">All goals</option>
            <option value="active">Active</option>
            <option value="completed">Completed</option>
            <option value="today">Updated today</option>
          </select>
        </div>

        <ul id="goals-list" class="goals-list"></ul>
        <div id="empty-state" class="empty-state">
          No goals yet. Start by adding one on the left ‚Äì even a tiny goal is enough to begin.
        </div>
      </article>
    </section>

    <!-- FOOTER -->
    <footer class="app-footer">
      <div class="footer-tagline">
        <span class="dot-pulse"></span>
        <span>Live progress mode ¬∑ Update in real time</span>
      </div>
      <div>
        Data stored in your browser (local only) ¬∑ Build your streak.
      </div>
    </footer>
  </div>

  <script>
    // --------- STATE & STORAGE ----------
    const STORAGE_KEY = "goalflow_v1_goals";
    const STREAK_KEY = "goalflow_v1_streak";
    const LAST_ACTIVE_DATE_KEY = "goalflow_v1_last_active_date";

    let goals = [];
    let completedTodayCount = 0;

    function loadFromStorage() {
      try {
        const saved = localStorage.getItem(STORAGE_KEY);
        goals = saved ? JSON.parse(saved) : [];
      } catch (e) {
        goals = [];
      }
    }

    function saveToStorage() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(goals));
    }

    function getTodayISO() {
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, "0");
      const day = String(now.getDate()).padStart(2, "0");
      return `${year}-${month}-${day}`;
    }

    function formatDateForLabel(date = new Date()) {
      return date.toLocaleDateString(undefined, {
        weekday: "short",
        day: "2-digit",
        month: "short",
        year: "numeric"
      });
    }

    function updateStreak(hasActivityToday) {
      const today = getTodayISO();
      const lastDate = localStorage.getItem(LAST_ACTIVE_DATE_KEY);
      let streak = Number(localStorage.getItem(STREAK_KEY) || "0");

      if (!hasActivityToday) {
        // Only compute streak if we know about last date
        if (lastDate) {
          const last = new Date(lastDate);
          const todayDate = new Date(today);
          const diffDays = Math.round((todayDate - last) / (1000 * 60 * 60 * 24));

          if (diffDays === 1) {
            streak = streak; // untouched
          } else if (diffDays > 1) {
            streak = 0;
            localStorage.setItem(STREAK_KEY, String(streak));
          }
        }
        return streak;
      }

      // When there is activity today
      if (!lastDate) {
        streak = 1;
      } else {
        const last = new Date(lastDate);
        const todayDate = new Date(today);
        const diffDays = Math.round((todayDate - last) / (1000 * 60 * 60 * 24));

        if (diffDays === 0) {
          // same day, don't increment
        } else if (diffDays === 1) {
          streak += 1;
        } else if (diffDays > 1) {
          streak = 1; // reset streak
        }
      }

      localStorage.setItem(LAST_ACTIVE_DATE_KEY, today);
      localStorage.setItem(STREAK_KEY, String(streak));
      return streak;
    }

    function getCurrentStreak() {
      return Number(localStorage.getItem(STREAK_KEY) || "0");
    }

    // ---------- DOM ELEMENTS ----------
    const todayLabel = document.getElementById("today-label");
    const metricActive = document.getElementById("metric-active");
    const metricProgress = document.getElementById("metric-progress");
    const metricCompletedToday = document.getElementById("metric-completed-today");
    const metricStreak = document.getElementById("metric-streak");

    const goalForm = document.getElementById("goal-form");
    const quickAddBtn = document.getElementById("quick-add-btn");
    const seedDemoBtn = document.getElementById("seed-demo-btn");

    const goalsListEl = document.getElementById("goals-list");
    const emptyStateEl = document.getElementById("empty-state");
    const searchInput = document.getElementById("search-input");
    const filterSelect = document.getElementById("filter-select");

    // ---------- INITIAL SETUP ----------
    function initDateLabel() {
      todayLabel.textContent = formatDateForLabel();
    }

    function seedDemoGoals() {
      const today = getTodayISO();
      goals = [
        {
          id: crypto.randomUUID(),
          title: "Workout 4x per week",
          category: "Fitness",
          target: 16,
          progress: 4,
          unitLabel: "sessions",
          dueDate: "",
          createdAt: today,
          updatedAt: today,
          completed: false
        },
        {
          id: crypto.randomUUID(),
          title: "Save ‚Çπ10,000 for emergency fund",
          category: "Money",
          target: 10000,
          progress: 3500,
          unitLabel: "‚Çπ",
          dueDate: "",
          createdAt: today,
          updatedAt: today,
          completed: false
        },
        {
          id: crypto.randomUUID(),
          title: "Finish 10 chapters of CNC notes",
          category: "Career",
          target: 10,
          progress: 3,
          unitLabel: "chapters",
          dueDate: "",
          createdAt: today,
          updatedAt: today,
          completed: false
        }
      ];
      saveToStorage();
      render();
    }

    // ---------- RENDERING ----------
    function computeMetrics() {
      const activeGoals = goals.filter(g => !g.completed);
      const todayISO = getTodayISO();

      let avg = 0;
      if (goals.length > 0) {
        const percents = goals.map(g => {
          if (!g.target || g.target <= 0) return 0;
          return Math.min(100, Math.round((g.progress / g.target) * 100));
        });
        avg = Math.round(percents.reduce((a, b) => a + b, 0) / goals.length);
      }

      completedTodayCount = goals.filter(g => g.updatedAt === todayISO && g.completed).length;

      metricActive.textContent = activeGoals.length;
      metricProgress.textContent = avg + "%";
      metricCompletedToday.textContent = completedTodayCount + " done today";

      // streak
      const hasActivityToday = goals.some(g => g.updatedAt === todayISO);
      const streak = updateStreak(hasActivityToday);
      metricStreak.textContent = streak;
    }

    function renderGoals() {
      const searchTerm = searchInput.value.trim().toLowerCase();
      const filter = filterSelect.value;
      const todayISO = getTodayISO();

      let filtered = goals.slice().sort((a, b) => {
        const aCompleted = a.completed ? 1 : 0;
        const bCompleted = b.completed ? 1 : 0;
        if (aCompleted !== bCompleted) return aCompleted - bCompleted; // active first
        return (b.updatedAt || "").localeCompare(a.updatedAt || "");
      });

      if (searchTerm) {
        filtered = filtered.filter(g =>
          g.title.toLowerCase().includes(searchTerm) ||
          (g.category && g.category.toLowerCase().includes(searchTerm))
        );
      }

      if (filter === "active") {
        filtered = filtered.filter(g => !g.completed);
      } else if (filter === "completed") {
        filtered = filtered.filter(g => g.completed);
      } else if (filter === "today") {
        filtered = filtered.filter(g => g.updatedAt === todayISO);
      }

      goalsListEl.innerHTML = "";

      if (filtered.length === 0) {
        emptyStateEl.style.display = "block";
        return;
      } else {
        emptyStateEl.style.display = "none";
      }

      filtered.forEach(goal => {
        const li = document.createElement("li");
        li.className = "goal-item";
        li.dataset.id = goal.id;

        const percent = goal.target > 0 ? Math.min(100, Math.round((goal.progress / goal.target) * 100)) : 0;

        const left = document.createElement("div");
        left.className = "goal-main";

        const titleRow = document.createElement("div");
        titleRow.className = "goal-title-row";

        const titleEl = document.createElement("div");
        titleEl.className = "goal-title";
        titleEl.textContent = goal.title;

        const chip = document.createElement("span");
        chip.className = "goal-chip";
        chip.textContent = goal.category || "Other";

        titleRow.appendChild(titleEl);
        titleRow.appendChild(chip);

        const meta = document.createElement("div");
        meta.className = "goal-meta";

        const progressText = document.createElement("span");
        const unitLabel = goal.unitLabel || "units";
        progressText.textContent = `${goal.progress}/${goal.target} ${unitLabel}`;

        const dot = document.createElement("span");
        dot.className = "meta-dot";

        const updatedText = document.createElement("span");
        updatedText.textContent = goal.updatedAt === todayISO ? "Updated today" :
          (goal.updatedAt ? `Updated ${goal.updatedAt}` : "Not updated");

        meta.appendChild(progressText);
        meta.appendChild(dot);
        meta.appendChild(updatedText);

        if (goal.completed) {
          const completedPill = document.createElement("span");
          completedPill.className = "status-pill completed";
          completedPill.textContent = "Completed";
          meta.appendChild(completedPill);
        } else if (percent >= 60) {
          const onTrack = document.createElement("span");
          onTrack.className = "status-pill";
          onTrack.textContent = "On track";
          meta.appendChild(onTrack);
        }

        const progressWrapper = document.createElement("div");
        progressWrapper.className = "goal-progress";

        const track = document.createElement("div");
        track.className = "progress-bar-track";

        const fill = document.createElement("div");
        fill.className = "progress-bar-fill";
        fill.style.width = percent + "%";

        track.appendChild(fill);

        const labelRow = document.createElement("div");
        labelRow.className = "progress-label-row";

        const leftLabel = document.createElement("span");
        leftLabel.textContent = percent + "%";

        const rightLabel = document.createElement("span");
        rightLabel.textContent = goal.dueDate ? `Due ${goal.dueDate}` : "No deadline";

        labelRow.appendChild(leftLabel);
        labelRow.appendChild(rightLabel);

        progressWrapper.appendChild(track);
        progressWrapper.appendChild(labelRow);

        left.appendChild(titleRow);
        left.appendChild(meta);
        left.appendChild(progressWrapper);

        const right = document.createElement("div");
        right.className = "goal-actions";

        const minusBtn = document.createElement("button");
        minusBtn.className = "mini-btn";
        minusBtn.textContent = "-1";
        minusBtn.title = "Decrease progress by 1";
        minusBtn.addEventListener("click", () => changeProgress(goal.id, -1));

        const plusBtn = document.createElement("button");
        plusBtn.className = "mini-btn accent";
        plusBtn.textContent = "+1";
        plusBtn.title = "Increase progress by 1";
        plusBtn.addEventListener("click", () => changeProgress(goal.id, 1));

        const doneBtn = document.createElement("button");
        doneBtn.className = "mini-btn accent";
        doneBtn.textContent = goal.completed ? "Undo complete" : "Mark done";
        doneBtn.addEventListener("click", () => toggleComplete(goal.id));

        const deleteBtn = document.createElement("button");
        deleteBtn.className = "mini-btn danger";
        deleteBtn.textContent = "Delete";
        deleteBtn.addEventListener("click", () => deleteGoal(goal.id));

        right.appendChild(minusBtn);
        right.appendChild(plusBtn);
        right.appendChild(doneBtn);
        right.appendChild(deleteBtn);

        li.appendChild(left);
        li.appendChild(right);
        goalsListEl.appendChild(li);
      });
    }

    function render() {
      renderGoals();
      computeMetrics();
    }

    // ---------- ACTIONS ----------
    function changeProgress(id, delta) {
      const today = getTodayISO();
      goals = goals.map(g => {
        if (g.id !== id) return g;
        let newProgress = g.progress + delta;
        if (newProgress < 0) newProgress = 0;
        if (g.target > 0 && newProgress > g.target) newProgress = g.target;
        return {
          ...g,
          progress: newProgress,
          updatedAt: today,
          completed: g.target > 0 && newProgress >= g.target
        };
      });
      saveToStorage();
      render();
    }

    function toggleComplete(id) {
      const today = getTodayISO();
      goals = goals.map(g => {
        if (g.id !== id) return g;
        const newCompleted = !g.completed;
        const newProgress = newCompleted && g.target > 0 ? g.target : g.progress;
        return {
          ...g,
          completed: newCompleted,
          progress: newProgress,
          updatedAt: today
        };
      });
      saveToStorage();
      render();
    }

    function deleteGoal(id) {
      if (!confirm("Delete this goal?")) return;
      goals = goals.filter(g => g.id !== id);
      saveToStorage();
      render();
    }

    function addGoalFromForm() {
      const titleInput = document.getElementById("goal-title");
      const categoryInput = document.getElementById("goal-category");
      const targetInput = document.getElementById("goal-target");
      const unitInput = document.getElementById("goal-unit-label");
      const dueInput = document.getElementById("goal-due");
      const startInput = document.getElementById("goal-start");

      const title = titleInput.value.trim();
      const target = Number(targetInput.value);
      if (!title || !target || target <= 0) return;

      const today = getTodayISO();
      const startToday = startInput.value === "today";

      const newGoal = {
        id: crypto.randomUUID(),
        title,
        category: categoryInput.value || "Other",
        target,
        progress: startToday ? 1 : 0,
        unitLabel: unitInput.value.trim() || "units",
        dueDate: dueInput.value || "",
        createdAt: today,
        updatedAt: startToday ? today : "",
        completed: false
      };

      goals.push(newGoal);
      saveToStorage();

      goalForm.reset();
      targetInput.value = "";
      unitInput.value = "";
      // Set defaults back
      document.getElementById("goal-category").value = "Fitness";
      document.getElementById("goal-start").value = "today";

      render();
    }

    function quickAddGoal() {
      const title = prompt("Quick goal name (e.g. 10,000 steps, 30 min study):");
      if (!title) return;
      const today = getTodayISO();

      const newGoal = {
        id: crypto.randomUUID(),
        title: title.trim(),
        category: "Other",
        target: 1,
        progress: 0,
        unitLabel: "unit",
        dueDate: "",
        createdAt: today,
        updatedAt: "",
        completed: false
      };

      goals.push(newGoal);
      saveToStorage();
      render();
    }

    // ---------- EVENTS ----------
    document.addEventListener("DOMContentLoaded", () => {
      initDateLabel();
      loadFromStorage();
      render();

      goalForm.addEventListener("submit", (e) => {
        e.preventDefault();
        addGoalFromForm();
      });

      quickAddBtn.addEventListener("click", quickAddGoal);
      seedDemoBtn.addEventListener("click", seedDemoGoals);
      searchInput.addEventListener("input", renderGoals);
      filterSelect.addEventListener("change", renderGoals);
    });
  </script>
</body>
</html>